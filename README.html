<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.7.1">
<title>Securing a web application</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote::before{display:none}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{word-spacing:0;line-height:1.6}
.quoteblock.abstract blockquote::before,.quoteblock.abstract p::before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
<h1>Securing a web application</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Learn how to secure a web application through authentication and authorization.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_youll_learn">What you&#8217;ll learn</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You will learn how to secure a web application by performing authentication and authorization using the Security feature in the Java EE 8 specification.</p>
</div>
<div class="paragraph">
<p>Authentication confirms the identity of the user by verifying a user name and password. While authorization determines whether a user has access to a specific servlet.</p>
</div>
<div class="paragraph">
<p>The security feature in Java EE provides capability to configure the basic, form or custom form authentication mechanism using annotations in the servlet.
It also provides a SecurityContext API for programmatic security checks for both web and enterprise beans resources.</p>
</div>
<div class="paragraph">
<p>You will learn how to implement form authentication. While basic authentication is only a pop up window for users to fill in their names and password, form authentication provides
an editable form for users to fill in and submit in order to log in to the system. Form authentication is more common and user-friendly in real life applications.</p>
</div>
<div class="paragraph">
<p>You will also learn how to assign permissions to different roles. This application specifies two roles: Administrator and User.</p>
</div>
<div class="paragraph">
<p>The application itself will allow users and admins to access pages.
The <code>user</code> page and <code>admin</code> pages display user information. Both pages will show the name of the currently authenticated user and the admin page will also show the role of the user.</p>
</div>
<div class="paragraph">
<p><a href="https://raw.githubusercontent.com/OpenLiberty/guides-common/master/gitclone.adoc" class="bare">https://raw.githubusercontent.com/OpenLiberty/guides-common/master/gitclone.adoc</a></p>
</div>
<div class="sect2">
<h3 id="_try_what_youll_build">Try what you&#8217;ll build</h3>
<div class="paragraph">
<p>The  <code>finish</code> directory in the root of this guide contains the finished security application with form authentication. Feel free to give it a try before you proceed.</p>
</div>
<div class="paragraph">
<p>To try out the application, first navigate to the <code>finish</code> directory and then run the following Maven goals to build the application and run it inside Open Liberty:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>mvn install liberty:start-server</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, point your browser to:
<code><a href="http://localhost:9080" class="bare">http://localhost:9080</a></code>
As you can see, the browser gets redirected from <code>http</code> to an <code>https</code> link automatically, this is accomplished through the transport guarantee that will be mentioned later on in the guide.</p>
</div>
<div class="paragraph">
<p>The Identity Store is provided with the following user information credentials:</p>
</div>
<table id="identitystoretable" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Identity Store</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Username</th>
<th class="tableblock halign-left valign-top">Password</th>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Group</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">alice</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">alicepwd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Employee</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bob</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bobpwd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin, user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager, Employee</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">carl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">carlpwd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin, user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TeamLead, Employee</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">david</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">davidpwd</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PartTime</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can access the application pages by signing in to the <code>Home Servlet</code> with one of the credentials from the Identity Store .</p>
</div>
<div class="paragraph">
<p>Notice that when you sign in as Bob or Carl, the browser redirects to the <code>admin</code> page and you can view their names as well as their role as <code>admin</code>.
When you sign in as Alice, you can only view Alice&#8217;s name. Furthermore, there is a person named David that belongs to a group called <code>PartTime</code> but has no role.
When you sign in as David, you will be blocked and a message will display <code>Error 403: AuthorizationFailed</code>.</p>
</div>
<div class="paragraph">
<p>Once you are done checking out the application, stop the Open Liberty server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>mvn liberty:stop-server</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_the_identity_store">Configuring the Identity Store</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Navigate to the  <code>start</code> directory to begin.</p>
</div>
<div class="paragraph">
<p>You need to set up the Identity Store to define users and group information. Identity Stores store user account information, such as user name and password, that can be accessed during authentication.
Typically, applications would use an external registry that could be configured with Lightweight Directory Access Protocol (LDAP). However, we will be using <code>Basic User Registry</code> as a simple example of an identity store for the purposes of this guide.</p>
</div>
<div class="paragraph">
<p>To do this, add the following configurations into the <code>src/main/liberty/config/server.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;server description="Sample Liberty server"&gt;

  &lt;featureManager&gt;
    &lt;feature&gt;servlet-4.0&lt;/feature&gt;
    &lt;feature&gt;appSecurity-3.0&lt;/feature&gt;
  &lt;/featureManager&gt;

  &lt;httpEndpoint id="defaultHttpEndpoint"
    httpPort="${server.http.port}"
    httpsPort="${server.https.port}" /&gt;

  &lt;!--
    It is recommended to store the wlp.password.encryption.key property
    in a file outside the server configuration directory.
  --&gt;
  &lt;include location="${pwd.encryption.key.location}"/&gt;

  &lt;!-- The keystore for SSL is built using the maven keytool plugin --&gt;
  &lt;keyStore id="defaultKeyStore" location="keystore.jceks" type="JCEKS"
    password="${wlp.password.encryption.key}"/&gt;

  &lt;basicRegistry id="basic" realm="WebRealm"&gt;
    &lt;user name="bob"
      password="{aes}ALLB9chb345H2MFrjM9HaEdoRG43WHc4bcMgWH0oS2GY" /&gt; &lt;!-- bobpwd --&gt;
    &lt;user name="alice"
      password="{xor}PjM2PDovKDs=" /&gt;  &lt;!-- alicepwd --&gt;
    &lt;user name="carl"
      password="{xor}PD4tMy8oOw==" /&gt;   &lt;!-- carlpwd --&gt;

    &lt;group name="Manager"&gt;
      &lt;member name="bob" /&gt;
    &lt;/group&gt;

    &lt;group name="TeamLead"&gt;
      &lt;member name="carl" /&gt;
    &lt;/group&gt;

    &lt;group name="Employee"&gt;
      &lt;member name="alice" /&gt;
      &lt;member name="bob" /&gt;
      &lt;member name="carl" /&gt;
    &lt;/group&gt;
  &lt;/basicRegistry&gt;

  &lt;application location="${application.name}" type="war" id="${application.name}"
               name="${application.name}" context-root="/"&gt;
    &lt;application-bnd&gt;
      &lt;security-role name="admin"&gt;
        &lt;group name="Manager" /&gt;
        &lt;group name="TeamLead" /&gt;
      &lt;/security-role&gt;
      &lt;security-role name="user"&gt;
        &lt;group name="Employee" /&gt;
      &lt;/security-role&gt;
    &lt;/application-bnd&gt;
  &lt;/application&gt;

&lt;/server&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>On the Open Liberty server, you can use a <code>Basic User Registry</code> as an identity store, to define the users and groups information.
In real life, you will probably connect to a database that stores the user account information.</p>
</div>
<div class="paragraph">
<p>When you set up the `Basic User Registry for authentication, the names for the users and groups must be unique.</p>
</div>
<div class="paragraph">
<p>In this application, there are four groups: <code>Employee</code>, <code>TeamLead</code>, <code>Manager</code> and <code>PartTime</code>. Groups can be assigned to different access roles.
Within the <code>&lt;application-bnd&gt;</code> tags, two different authorization roles are assigned to these groups: <code>admin</code> and <code>user</code>.</p>
</div>
<div class="paragraph">
<p>A role can be mapped to a user, a group, or a special subject. The two types of special subject are <code>EVERYONE</code> and <code>ALL_AUTHENTICATED_USERS</code>.
When a role is mapped to the <code>EVERYONE</code> special subject, there is no security because everyone is allowed access and you are not prompted to enter credentials.
When a role is mapped to the <code>ALL_AUTHENTICATED_USERS</code> special subject, then any user who is authenticated by the application server can access the protected resource.</p>
</div>
<div class="sect2">
<h3 id="_encrypting_passwords_using_securityutility">Encrypting passwords using securityUtility</h3>
<div class="paragraph">
<p>You need to encrypt the passwords so that they will not appear as plain text in the <code>server.xml</code> file, or, in the database in real life.
It mainly protects user credentials from internal attacks, such as information leaking from the inside of an organization.</p>
</div>
<div class="paragraph">
<p>The passwords assigned to the accounts in identity store is encoded with Liberty&#8217;s <code>securityUtility</code> command. The <code>securityUtility</code> is a command that supports plain text encryption and SSL certificate creation for Liberty.</p>
</div>
<div class="paragraph">
<p>Navigate to <code>liberty/wlp/bin</code> in the Liberty server source code you downloaded, and run the following if you have a macOS/Linux machine:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>./securityUtility encode --encoding=xor alicepwd</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, <code>alice</code> and <code>carl</code> use the XOR encoding for their passwords. While <code>bob</code> uses Advanced Encryption Standard (AES) encryption.
You need to specify a key string to be used when you encode using AES encryption. This string is hashed to produce an encryption key that is used to encrypt and decrypt the password.
The key string is provided from the <code>bootstrapProperties</code> in the <code>pom.xml</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>./securityUtility encode --encoding=aes --key=mykey bobpwd</code></pre>
</div>
</div>
<div class="paragraph">
<p>The encryption key can be provided to the server by defining the variable <code>wlp.password.encryption.key</code> and setting the value to the key.
Setting this variable, overrides the default key that is generated. This property is set in a configuration file that should only contain this single property declaration.
The configuration file itself is saved outside of the configuration directory for the server, this ensures that the file containing your key is not included when running the the server dump or package command.
In this application, the configuration file is saved under <code>src/main/liberty/config</code> as <code>pwdEncryptionKey.xml</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementing_authentication">Implementing authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Form Authentication is an authentication mechanism where the user is able to fill in their login credentials using a form that the developers create.
Java EE provides a more convenient way to authenticate a user by calling the built-in <code>j_security_check</code> action from the login form.
The <code>welcome.html</code> and <code>error.html</code> pages are provided for you under the <code>src/main/webapp</code> directory. These are two frontend files that provide the login form and error page.</p>
</div>
<div class="paragraph">
<p>In order to enable form authentication, create the <code>HomeServlet</code> class in the <code>src/main/java/io/openliberty/guides/ui/HomeServlet.java</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">Unresolved directive in README.adoc - include::finish/src/main/java/io/openliberty/guides/ui/HomeServlet.java[tags=homeservlet;!copyright]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the <code>@FormAuthenticationMechanismDefinition</code> annotation in the class.
The <code>@LoginToContinue</code> annotation allows the application to add specific login functionality to the <code>AuthenticationMechanism</code>.
The annotation links the two pages that are required for the form authentication mechanism. The pages are the <code>errorPage</code> and the <code>loginPage</code>.</p>
</div>
<div class="paragraph">
<p>At this point, your application is secured using form authentication.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adding_authorization">Adding authorization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Authorization determines whether a user has the role required to access to whichever secondary page the <code>HomeServlet</code> will redirect them to.</p>
</div>
<div class="paragraph">
<p>Authorization can be achieved with the <code>@ServletSecurity</code> annotation.
Open the <code>src/main/java/io/openliberty/guides/ui/UserServlet.java</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package io.openliberty.guides.ui;

import java.io.IOException;
import java.io.PrintWriter;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.annotation.ServletSecurity;
import javax.servlet.annotation.HttpConstraint;
import javax.security.enterprise.authentication.mechanism.http.FormAuthenticationMechanismDefinition;
import javax.security.enterprise.authentication.mechanism.http.LoginToContinue;
import javax.security.enterprise.SecurityContext;
import javax.inject.Inject;

@WebServlet(urlPatterns = "/user")
@FormAuthenticationMechanismDefinition(loginToContinue = @LoginToContinue(
  errorPage = "/error.html", loginPage = "/login.html"))
@ServletSecurity(value = @HttpConstraint(rolesAllowed = { "user", "admin" },
  transportGuarantee = ServletSecurity.TransportGuarantee.CONFIDENTIAL))

public class UserServlet extends HttpServlet {

  private static final long serialVersionUID = 1L;

  @Inject
  private SecurityContext securityContext;

  /**
   * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse
   *      response)
   */
  protected void doGet(HttpServletRequest request, HttpServletResponse response)
      throws ServletException, IOException {

    PrintWriter pw = response.getWriter();
	String contextName = Utils.UNKNOWN;

    if (securityContext.getCallerPrincipal() != null) {
      contextName = securityContext.getCallerPrincipal().getName();
    }

	Utils.contructHTML(pw, this.getClass().getSimpleName(), null, contextName);
  }

  /**
   * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse
   *      response)
   */
  protected void doPost(HttpServletRequest request, HttpServletResponse response)
      throws ServletException, IOException {
    doGet(request, response);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the <code>@HttpConstraint</code> annotation, it defines all the security constraints for each servlet resource.
The <code>admin</code> and <code>user</code> are roles you defined in the <code>server.xml</code> configuration file. They are declared under <code>rolesAllowed</code> so that the profile can be accessed by authenticated accounts with these two roles.</p>
</div>
<div class="paragraph">
<p>The transport guarantee defines the data protection requirements that must be satisfied by the transport. In this case, the transport guarantee is set to the <code>CONFIDENTIAL</code> configuration which specifies that all user data must be encrypted during transport.
This ensures that the browser gets redirected from <code>http</code> to an <code>https</code> link automatically.
The Security specification also defines a common SecurityContext API that can be used to perform some common programmatic security related operations.
You can get access to the information of the authenticated account by calling the appropriate methods from the <code>SecurityContext</code> API.</p>
</div>
<div class="paragraph">
<p>The method <code>securityContext.isCallerInRole(Utils.ADMIN)</code> returns a boolean that indicates if the current authenticated account is an <code>admin</code> or not.
The method <code>securityContext.isCallerInRole(Utils.USER)</code> returns a boolean that indicates if the current authenticated account is an <code>user</code> or not.</p>
</div>
<div class="paragraph">
<p>Open the <code>src/main/webapp/WEB-INF/web.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java"></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the <code>security-constraint</code> that is specified for the <code>admin</code> and <code>user</code> pages.
Since these pages are <code>Java Server Faces</code>, their security constraint is define in the <code>src/main/webapp/WEB-INF/web.xml</code> file.</p>
</div>
<div class="paragraph">
<p><a href="https://raw.githubusercontent.com/OpenLiberty/guides-common/master/mvnbuild.adoc" class="bare">https://raw.githubusercontent.com/OpenLiberty/guides-common/master/mvnbuild.adoc</a></p>
</div>
<div class="paragraph">
<p>Use the <code><a href="http://localhost:9080/" class="bare">http://localhost:9080/</a></code> endpoint to choose the information you want to see.</p>
</div>
<div class="paragraph">
<p>Use one of the credentials from the <a href="#identitystore">[identitystore]</a> to log in.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing_the_application">Testing the application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now you can write the <code>SecurityTest</code> class to test that you can access different servlets with form authentication and authorization.</p>
</div>
<div class="paragraph">
<p>Create a test class in the <code>src/test/java/it/io/openliberty/guides/security/SecurityTest.java</code> file like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package it.io.openliberty.guides.security;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertTrue;

import java.net.URI;
import java.security.SecureRandom;
import java.security.cert.CertificateException;
import java.security.cert.X509Certificate;
import java.util.ArrayList;
import java.util.List;

import javax.net.ssl.HttpsURLConnection;
import javax.net.ssl.SSLContext;
import javax.net.ssl.TrustManager;
import javax.net.ssl.X509TrustManager;
import javax.servlet.http.HttpServletResponse;

import org.apache.http.HttpResponse;
import org.apache.http.NameValuePair;
import org.apache.http.client.HttpClient;
import org.apache.http.client.config.CookieSpecs;
import org.apache.http.client.config.RequestConfig;
import org.apache.http.client.entity.UrlEncodedFormEntity;
import org.apache.http.client.methods.HttpGet;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.impl.client.HttpClientBuilder;
import org.apache.http.message.BasicNameValuePair;
import org.apache.http.util.EntityUtils;
import org.junit.Before;
import org.junit.Test;

public class SecurityTest {

  private static String urlHttp;
  private static String urlHttps;

  private void trustAll() throws Exception {
          SSLContext sslContext = SSLContext.getInstance("SSL");
          sslContext.init(
            null,
            new TrustManager[] {
              new X509TrustManager() {
                  @Override
                    public void checkClientTrusted(X509Certificate[] arg0, String arg1)
                      throws CertificateException {}

                  @Override
                    public void checkServerTrusted(X509Certificate[] arg0, String arg1)
                      throws CertificateException {}

                    public X509Certificate[] getAcceptedIssuers() {
                        return null;
                    }
              }
            },
            new SecureRandom());
          SSLContext.setDefault(sslContext);
          HttpsURLConnection.setDefaultSSLSocketFactory(sslContext.getSocketFactory());
  }

  @Before
  public void setup() throws Exception {
    urlHttp = "http://localhost:" + System.getProperty("liberty.test.port");
    urlHttps = "https://localhost:" + System.getProperty("liberty.test.ssl.port");
    trustAll();
  }

  @Test
  public void testAuthenticationFail() throws Exception {
    executeURL("/user", "bob", "wrongpassword", true, -1, "Don't care");
    System.out.println("testAuthenticationFail passed!");
  }

  @Test
  public void testAuthenticationSucceed() throws Exception {
    executeURL("/user", "bob", "bobpwd", false,
      HttpServletResponse.SC_OK, "UserServlet");
    System.out.println("testAuthenticationSucceed passed!");
  }

  @Test
  public void testAuthorizationForAdmin() throws Exception {
    executeURL("/admin", "bob", "bobpwd", false,
      HttpServletResponse.SC_OK, "AdminServlet");
    System.out.println("testAuthorizationForAdmin passed!");
  }

  @Test
  public void testAuthorizationForUser() throws Exception {
    executeURL("/admin", "alice", "alicepwd", false,
      HttpServletResponse.SC_FORBIDDEN, "Error 403: AuthorizationFailed");
    System.out.println("testAuthorizationForUser passed!");
  }

  private void executeURL(
    String testUrl, String userid, String password,
    boolean expectLoginFail, int expectedCode, String expectedContent)
    throws Exception {

    // Use HttpClient to execute the testUrl by HTTP
    URI url = new URI(urlHttp + testUrl);
    HttpGet getMethod = new HttpGet(url);
    HttpClientBuilder clientBuilder = HttpClientBuilder.create();
    SSLContext sslContext = SSLContext.getDefault();
    clientBuilder.setSSLContext(sslContext);
    clientBuilder.setDefaultRequestConfig(
      RequestConfig.custom().setCookieSpec(CookieSpecs.STANDARD).build());
    HttpClient client = clientBuilder.build();
    HttpResponse response = client.execute(getMethod);

    // The response should return the login.html
    String loginBody = EntityUtils.toString(response.getEntity(), "UTF-8");
    assertTrue(
      "The login.html was not redirected",
      loginBody.contains("j_security_check"));

    // Use j_security_check to login
    HttpPost postMethod = new HttpPost(urlHttps + "/j_security_check");
    List&lt;NameValuePair&gt; nvps = new ArrayList&lt;NameValuePair&gt;();
    nvps.add(new BasicNameValuePair("j_username", userid ));
    nvps.add(new BasicNameValuePair("j_password", password));
    postMethod.setEntity(new UrlEncodedFormEntity(nvps, "UTF-8"));
    response = client.execute(postMethod);
    assertEquals(
      "Expected " + HttpServletResponse.SC_FOUND + " status code for login",
      HttpServletResponse.SC_FOUND, response.getStatusLine().getStatusCode());

    // Return if expect the login should fail
    if (expectLoginFail) {
      String location = response.getFirstHeader("Location").getValue();
      assertTrue(
        "Error.html was not returned",
        location.contains("error.html"));
      return;
    }

    // Use HttpClient to execute the testUrl by HTTPS
    url = new URI(urlHttps + testUrl);
    getMethod = new HttpGet(url);
    response = client.execute(getMethod);
    assertEquals(
      "Expected " + expectedCode + " status code for login",
      expectedCode, response.getStatusLine().getStatusCode());

    // Check the content of the response returned
    String actual = EntityUtils.toString(response.getEntity(), "UTF-8");
    assertTrue(
      "The url " + testUrl +
      " did not return the expected content \"" + expectedContent + "\"" +
      "The actual content was: \"" + actual + "\".",
      actual.contains(expectedContent));
  }

}
// end::test[]</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are four test cases. The <code>testAuthenticationFail()</code> case tests a invalid user authentication,
while the <code>testAuthenticationSucceed()</code> case tests a successful authentication process.</p>
</div>
<div class="paragraph">
<p>The <code>testAuthorizationForAdmin()</code> and <code>testAuthorizationForUser()</code> cases verify
that only administrator account such as bob can access the <code>admin</code> page. However, a normal user like alice can only access the <code>user</code> page.</p>
</div>
<div class="paragraph">
<p>The <code>executeURL()</code> method contains the main logic of testing form authentication.</p>
</div>
<div class="paragraph">
<p>First, the method uses an HttpClient to execute the URL that is passed in by HTTP. After hitting this URL, the response should return the login.html.
Next, we use Java EE&#8217;s <code>j_security_check</code>, as mentioned above, to login. If the test was meant to fail, the method checks whether or not the response page is the <code>error.html</code> page.
Otherwise, the method executes the redirected URL and checks the contents of the redirected response to see if they match the correct <code>admin</code> or <code>user</code> page.</p>
</div>
<div class="paragraph">
<p><a href="https://raw.githubusercontent.com/OpenLiberty/guides-common/master/mvnverify.adoc" class="bare">https://raw.githubusercontent.com/OpenLiberty/guides-common/master/mvnverify.adoc</a></p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre class="prettyprint highlight"><code>-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running it.io.openliberty.guides.security.SecurityTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.78 sec - in it.io.openliberty.guides.security.SecurityTest

Results :

Tests run: 4, Failures: 0, Errors: 0, Skipped: 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>To see whether the tests detect a failure, you can change some input arguments in any of the test cases.
Rerun the Maven build. You see that a test failure occurs.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_great_work_youre_done">Great work! You&#8217;re done!</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You learned how to use Java EE Security feature to authenticate and authorize users to secure your web application.</p>
</div>
<div class="paragraph">
<p>Next, you can try the related MicroProfile-JWT guide. It demonstrates technologies to secure backend services and expand on what you built here.</p>
</div>
<div class="paragraph">
<p><a href="https://raw.githubusercontent.com/OpenLiberty/guides-common/master/finish.adoc" class="bare">https://raw.githubusercontent.com/OpenLiberty/guides-common/master/finish.adoc</a></p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-09-21 15:53:43 EDT
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
<script>prettyPrint()</script>
</body>
</html>